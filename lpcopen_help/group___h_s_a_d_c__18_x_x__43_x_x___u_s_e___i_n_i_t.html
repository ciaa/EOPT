<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>LPCOpen Platform for LPC18XX/43XX microcontrollers: HSADC driver setup and initialization</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="driver.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">LPCOpen Platform for LPC18XX/43XX microcontrollers
   &#160;<span id="projectnumber">18XX43XX</span>
   </div>
   <div id="projectbrief">LPCOpen Platform for the NXP LPC18XX/43XX family of Microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">HSADC driver setup and initialization<div class="ingroups"><a class="el" href="group___h_s_a_d_c__18_x_x__43_x_x___u_s_e.html">LPC18xx/43xx High speed ADC driver use examples</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p><b>What to know before using this driver</b><br/>
 The HSADC peripheral requires several clocks - the register interface clock and the sample clock. Although the driver's Init() and DeInit() functions handle enabling and disabling of the clocks, the sample clock rate is not setup as part of the driver and there are no functions for selecting a sample clock rate as part of the driver. This must be done outside the driver - preferably before calling <a class="el" href="group___h_s_a_d_c__18_x_x__43_x_x.html#gad72fb94bbb485c84687a4e75c63090ea" title="Initialize the High speed ADC.">Chip_HSADC_Init()</a> or any other HSADC driver function. To setup the HSADC sample clock, a base clock source needs to be selected for the HSADC sample clock. The following clock driver function performs this:<br/>
 </p>
<pre class="fragment">    /* Attach the VADC sample clock to a base clock */
    Chip_Clock_SetBaseClock(CLK_BASE_ADCHS, \&lt;BASE_CLOCK\&gt;, true, false);
</pre><p> The selected &lt;BASE_CLOCK&gt; can be one of the selectable input clocks such as CLKIN_IRC or CLKIN_AUDIOPLL or routed via a divider such as CLKIN_IDIVA. The selected clock rate must not exceed 80MHz.<br/>
 <em>Hint: You can get the clock rate for a base clock by using the Chip_Clock_GetClockInputHz(&lt;BASE_CLOCK&gt;) function. The HSADC sample rate (which includes the base clock and any dividers in the clock generation path can be determined with a call to <a class="el" href="group___h_s_a_d_c__18_x_x__43_x_x.html#gae05840f7109ac514c0a6c696013c0b4c" title="Returns the clock rate in Hz for the HSADC.">Chip_HSADC_GetBaseClockRate()</a>.</em><br/>
</p>
<p><b>Basic initialization of the HSADC driver</b><br/>
 Once HSADC sample clocking is setup, the first call that is needed is a call the <a class="el" href="group___h_s_a_d_c__18_x_x__43_x_x.html#gad72fb94bbb485c84687a4e75c63090ea" title="Initialize the High speed ADC.">Chip_HSADC_Init()</a>. This enables the HSADC clocking and places the HSADC into a default state.<br/>
 </p>
<pre class="fragment">    /* Initialize the HSADC */
    Chip_HSADC_Init(CLK_BASE_ADCHS);
</pre><p> After the HSADC has been initialized with a call to <a class="el" href="group___h_s_a_d_c__18_x_x__43_x_x.html#gad72fb94bbb485c84687a4e75c63090ea" title="Initialize the High speed ADC.">Chip_HSADC_Init()</a>, the HSADC can be setup and configured for desired operation.<br/>
</p>
<p><b>HSADC FIFO configuration</b><br/>
 The FIFO trip point for a DMA request or interrupt servicing and optional data packing can be setup with the following call.<br/>
 </p>
<pre class="fragment">    /* Setup HSADC to generate an interrupt or DMA request at 8 samples.
       Also enables FIFP data packing (2 samples per FIFO entry)*/
    Chip_HSADC_SetupFIFO(LPC_ADCHS, 8, true);
</pre><p><b>HSADC trigger setup, channel ID, and recovery time</b><br/>
 The HSADC trigger source and level, optional channel ID, and recovery time are configured with a call to <a class="el" href="group___h_s_a_d_c__18_x_x__43_x_x.html#ga8c4af826fb55c7aa1dfe4cf96cb1b1c2" title="Configure HSADC trigger source and recovery time.">Chip_HSADC_ConfigureTrigger()</a>.<br/>
 </p>
<pre class="fragment">    /* Usw SW triggering, add channel ID to FIFO word, 60 clocks recovery */
    Chip_HSADC_ConfigureTrigger(LPC_ADCHS, HSADC_CONFIG_TRIGGER_SW, HSADC_CONFIG_TRIGGER_RISEEXT,
        HSADC_CONFIG_TRIGGER_NOEXTSYNC, HSADC_CHANNEL_ID_EN_ADD, 60);
</pre><p><b>HSADC speed and power setup</b><br/>
 The HSADC power and speed settings must be configured to the HSADC sample clock. The <a class="el" href="group___h_s_a_d_c__18_x_x__43_x_x.html#ga776d07e6bc51347515f92ed36a9da561" title="Setup (common) HSADC power and speed settings.">Chip_HSADC_SetPowerSpeed()</a> function must be called to set these timings and after any HSADC sample clock rate change. This function also selects the data format used for samples - either binary offset or 2's complement.<br/>
 </p>
<pre class="fragment">    /* Configure HSADC power and speed settings and set data format to 2's complement */
    Chip_HSADC_SetPowerSpeed(LPC_ADCHS, true);
</pre><p><b>HSADC input biasing setup</b><br/>
 The HSADC has 6 input channels. Each channel can be individually configured with it's own bias. To setup a channel for AC biasing, select no bias options for negative and positive biases. If a DC bias is needed, select negative and positive biases.<br/>
 </p>
<pre class="fragment">    /* Select both positive and ngeative DC biasing for input 3 */
    Chip_HSADC_SetACDCBias(LPC_ADCHS, 3, HSADC_CHANNEL_DCBIAS, HSADC_CHANNEL_DCBIAS);
</pre><p><b>Enabling HSADC opwer</b><br/>
 Before using the HSADC, the power to the ADC and the band gap reference needs to be enabled. The power can be enabled and disabled with a call to <a class="el" href="group___h_s_a_d_c__18_x_x__43_x_x.html#gab95b239db991c736bfb93db97d8794d9" title="Enable HSADC power control and band gap reference.">Chip_HSADC_EnablePower()</a> or <a class="el" href="group___h_s_a_d_c__18_x_x__43_x_x.html#gadc1d32d51f7740e560ba04c3d770afa2" title="Disable HSADC power control and band gap reference.">Chip_HSADC_DisablePower()</a> functions.<br/>
 </p>
<pre class="fragment">    /* Enable HSADC power */
 Chip_HSADC_DisablePower(LPC_ADCHS);
</pre><p><b>Optional threshold setup</b><br/>
 HSADC samples can optionally be compared against threshold values during sampling. The status - inside, above, or below the threshold is contained in the status fields of the HSADC sample. Two low and two high thresholds can be setup for monitoring during sampling. These thresolds are setup with the <a class="el" href="group___h_s_a_d_c__18_x_x__43_x_x.html#ga86ed5ab3da9ea3a6bbfd138530d5d73d" title="Set HSADC Threshold low value.">Chip_HSADC_SetThrLowValue()</a> and <a class="el" href="group___h_s_a_d_c__18_x_x__43_x_x.html#ga0690a0edb51bd4070384c35196f1a73d" title="Set HSADC Threshold high value.">Chip_HSADC_SetThrHighValue()</a> functions.<br/>
 </p>
<pre class="fragment">    /* Set A low threshold to 10% of maximum sample resolution */
 Chip_HSADC_SetThrLowValue(LPC_ADCHS, 0, ((HSADC_MAX_SAMPLEVAL * 1) / 10));

    /* Set A high threshold to 90% of maximum sample resolution */
 Chip_HSADC_SetThrHighValue(LPC_ADCHS, 0, ((HSADC_MAX_SAMPLEVAL * 9) / 10));

    /* Set B low threshold to 30% of maximum sample resolution */
 Chip_HSADC_SetThrLowValue(LPC_ADCHS, 1, ((HSADC_MAX_SAMPLEVAL * 3) / 10));

    /* Set B high threshold to 70% of maximum sample resolution */
 Chip_HSADC_SetThrHighValue(LPC_ADCHS, 1, ((HSADC_MAX_SAMPLEVAL * 7) / 10));
</pre> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu May 15 2014 09:23:23 for LPCOpen Platform for LPC18XX/43XX microcontrollers by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
